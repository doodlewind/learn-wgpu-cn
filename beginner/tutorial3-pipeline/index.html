<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 Pipeline | 学习 Wgpu</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta property="article:modified_time" content="2022-04-24T06:22:00.000Z">
    <meta property="og:site_name" content="学习 Wgpu">
    <meta property="og:title" content="使用 Pipeline">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/beginner/tutorial3-pipeline/">
    <meta name="twitter:title" content="使用 Pipeline">
    <meta name="twitter:url" content="/beginner/tutorial3-pipeline/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Benjamin Hansen">
    <meta name="twitter:creator" content="https://twitter.com/sotrh760">
    
    <link rel="preload" href="/learn-wgpu-cn/assets/css/0.styles.9735b80e.css" as="style"><link rel="preload" href="/learn-wgpu-cn/assets/js/app.4ff5359b.js" as="script"><link rel="preload" href="/learn-wgpu-cn/assets/js/4.7de995c5.js" as="script"><link rel="preload" href="/learn-wgpu-cn/assets/js/15.866ab171.js" as="script"><link rel="preload" href="/learn-wgpu-cn/assets/js/25.997fcfd2.js" as="script"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/1.5a74b06a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/10.7328fa8a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/11.7ede3084.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/12.1618c781.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/13.8ed4ca2f.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/14.27582479.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/16.65e20a6a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/17.13dd0d98.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/18.0b7e17b3.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/19.e99c2c0b.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/2.1ff473f9.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/20.e60a9b69.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/21.640f3b7f.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/22.5e9abdb4.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/23.428ad388.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/24.ddf53bad.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/26.d0cb4a73.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/27.4b3c16d0.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/28.e072a203.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/29.126bb05e.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/30.661cb844.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/31.4d3f435a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/32.e5012b0b.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/33.336b62e7.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/34.08650f25.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/35.20773e94.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/5.79560850.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/6.4f6de209.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/7.430483e0.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/8.24d6fd2e.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/9.0426af3e.js">
    <link rel="stylesheet" href="/learn-wgpu-cn/assets/css/0.styles.9735b80e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu-cn/" class="home-link router-link-active"><!----> <span class="site-name">学习 Wgpu</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu-cn/" aria-current="page" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-cn/beginner/tutorial1-window/" class="sidebar-link">依赖与窗口</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial2-surface/" class="sidebar-link">使用 Surface</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/" aria-current="page" class="active sidebar-link">使用 Pipeline</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#什么是-pipeline" class="sidebar-link">什么是 Pipeline？</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#什么是着色器" class="sidebar-link">什么是着色器？</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#什么是顶点和片元" class="sidebar-link">什么是顶点和片元？</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#wgsl" class="sidebar-link">WGSL</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#编写着色器" class="sidebar-link">编写着色器</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#如何使用着色器" class="sidebar-link">如何使用着色器？</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#使用-pipeline-2" class="sidebar-link">使用 Pipeline</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/#小测验" class="sidebar-link">小测验</a></li></ul></li><li><a href="/learn-wgpu-cn/beginner/tutorial4-buffer/" class="sidebar-link">顶点缓冲区与索引缓冲区</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial5-textures/" class="sidebar-link">纹理与 BindGroup</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial6-uniforms/" class="sidebar-link">Uniform 缓冲区与 3D 相机</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial7-instancing/" class="sidebar-link">实例化绘制</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial8-depth/" class="sidebar-link">深度缓冲区</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial9-models/" class="sidebar-link">加载模型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-cn/intermediate/tutorial10-lighting/" class="sidebar-link">🚧 处理光照效果</a></li><li><a href="/learn-wgpu-cn/intermediate/tutorial11-normals/" class="sidebar-link">🚧 法线贴图</a></li><li><a href="/learn-wgpu-cn/intermediate/tutorial12-camera/" class="sidebar-link">🚧 更好的相机</a></li><li><a href="/learn-wgpu-cn/intermediate/tutorial13-threading/" class="sidebar-link">🚧 基于 Wgpu 和 Rayon 的多线程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>案例展示</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>更新动态</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用-pipeline"><a href="#使用-pipeline" class="header-anchor">#</a> 使用 Pipeline</h1> <h2 id="什么是-pipeline"><a href="#什么是-pipeline" class="header-anchor">#</a> 什么是 Pipeline？</h2> <p>如果你熟悉 OpenGL，你可能还记得对着色器程序的使用。你可以认为 pipeline（管线）较其更为强大。一条 pipeline 描述了 GPU 在操作数据集时将执行的所有动作。在本节中，我们将具体创建一条 <code>RenderPipeline</code>。</p> <h2 id="什么是着色器"><a href="#什么是着色器" class="header-anchor">#</a> 什么是着色器？</h2> <p>着色器是发送到 GPU 上执行的小段程序，用于对数据进行操作（注意区分程序与数据，译者注）。着色器有三种主要类型：顶点着色器、片元着色器和计算着色器。另外还存在一些如几何着色器这样其他类型的着色器，但这已经属于较为进阶的话题。现在我们只需要使用顶点着色器和片元着色器。</p> <h2 id="什么是顶点和片元"><a href="#什么是顶点和片元" class="header-anchor">#</a> 什么是顶点和片元？</h2> <p>一个顶点（vertex）就是三维（或二维）空间中的一个点。这些顶点会两两成组以构成线段，或者三个一组以构成三角形。</p> <img src="/learn-wgpu-cn/assets/img/tutorial3-pipeline-vertices.5e39e8fc.png"> <p>大多数现代渲染系统使用三角形来建模所有形体。从简单如立方体到复杂如人体的结构，均可按此方式表达。这些三角形会被存储为一长串顶点，其中每个顶点均存储与某空间位置相关联的数据（注意顶点数据中未必仅有该点的坐标位置，译者注）。</p> <p>我们需要先用顶点着色器来处理顶点，以便按我们的需求对形体做变换。</p> <p>然后，顶点会被转换为片元（fragment）。渲染产物图像中的每个像素至少对应一个片元。每个片元都具备一个颜色，该颜色可被复制到其对应的像素。片元着色器可决定片元的颜色。</p> <h2 id="wgsl"><a href="#wgsl" class="header-anchor">#</a> WGSL</h2> <p><a href="https://www.w3.org/TR/WGSL/" target="_blank" rel="noopener noreferrer">WebGPU Shading Language<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（WGSL）是 WebGPU 的着色器语言。WGSL 的开发重点是使其能轻松转换为与某渲染后端对应的着色器语言，如 Vulkan 的 SPIR-V、Metal 的 MSL、DX12 的 HLSL 和 OpenGL 的 GLSL 等。这些转换是在内部完成的，我们通常不需要关心这些细节。对 wgpu 而言，这一过程是由名为 <a href="https://github.com/gfx-rs/naga" target="_blank" rel="noopener noreferrer">naga<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的库完成的。</p> <p>注意在本文写作时，一些 WebGPU 实现也支持 SPIR-V，但这只是向 WGSL 过渡期间的临时性措施，其支持最终将被移除（如果你对 SPIR-V 和 WGSL 背后的八卦感到好奇，请参考<a href="http://kvark.github.io/spirv/2021/05/01/spirv-horrors.html" target="_blank" rel="noopener noreferrer">这篇博文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）。</p> <div class="note"><p>如果你曾阅读过本教程，你可能会注意到笔者已从 GLSL 迁移到 WGSL。鉴于标准对 GLSL 的支持较为次要，而 WGSL 才是 WGPU 的一等公民语言，故笔者选择将所有教程均迁移到使用 WGSL。仓库中一些展示性的 demo 仍会使用 GLSL，但主要教程和所有的配套示例都将使用 WGSL。</p></div> <div class="note"><p>WGSL 规范及其在 WGPU 中的应用仍在开发之中。如果你在使用时遇到问题，或许可以在 <a href="https://app.element.io/#/room/#wgpu:matrix.org" target="_blank" rel="noopener noreferrer">https://app.element.io/#/room/#wgpu:matrix.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 请社区参与者们看一下你的代码。</p></div> <h2 id="编写着色器"><a href="#编写着色器" class="header-anchor">#</a> 编写着色器</h2> <p>首先在与 <code>main.rs</code> 同级的目录中创建一个 <code>shader.wgsl</code> 文件，在其中写入以下代码：</p> <div class="language-wgsl extra-class"><pre class="language-text"><code>// 顶点着色器

struct VertexOutput {
    [[builtin(position)]] clip_position: vec4&lt;f32&gt;;
};

[[stage(vertex)]]
fn vs_main(
    [[builtin(vertex_index)]] in_vertex_index: u32,
) -&gt; VertexOutput {
    var out: VertexOutput;
    let x = f32(1 - i32(in_vertex_index)) * 0.5;
    let y = f32(i32(in_vertex_index &amp; 1u) * 2 - 1) * 0.5;
    out.clip_position = vec4&lt;f32&gt;(x, y, 0.0, 1.0);
    return out;
}
</code></pre></div><p>我们先声明了 <code>struct</code> 来存储顶点着色器的输出，其中目前只有一个字段，即顶点的 <code>clip_position</code>。<code>[[builtin(position)]]</code> 这段标记告诉 wgpu，这个值应当作为顶点在<a href="https://en.wikipedia.org/wiki/Clip_coordinates" target="_blank" rel="noopener noreferrer">剪切坐标系<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的位置来使用，类似于 GLSL 的 <code>gl_Position</code> 变量。</p> <div class="note"><p>WGSL 中形如 <code>vec4</code> 的矢量类型是泛型。目前你必须指定矢量内部值的具体类型。因此，一个使用 32 位浮点数的三维向量对应 <code>vec3&lt;f32&gt;</code>。</p></div> <p>着色器代码的下一部分是 <code>vs_main</code> 函数。我们用 <code>[[stage(vertex)]]</code> 将这个函数标记为顶点着色器的有效入口。它需要传入一个名为 <code>in_vertex_index</code> 的 <code>u32</code> 参数，而这个参数会从 <code>[[builtin(vertex_index)]]</code> 处取值。</p> <p>然后我们用 <code>VertexOutput</code> struct 定义了一个名为 <code>out</code> 的变量，还为三角形的 <code>x</code> 和 <code>y</code> 创建了另外两个变量。</p> <div class="note"><p>此处的 <code>f32()</code> 和 <code>i32()</code> 代码是显式类型转换（cast）的例子。</p></div> <div class="note"><p>用 <code>var</code> 定义的变量可以被修改，但必须指定其类型。用 <code>let</code> 创建的变量可以推断出它们的类型，但在着色器中不能改变它们的值。</p></div> <p>现在我们可以把 <code>clip_position</code> 保存到 <code>out</code> 了。然后只要返回 <code>out</code>，我们就完成了顶点着色器的工作！</p> <div class="note"><p>就技术上而言，这个例子中也可以不使用 struct，直接做如下操作即可：</p> <div class="language-wgsl extra-class"><pre class="language-text"><code>[[stage(vertex)]]
fn vs_main(
    [[builtin(vertex_index)]] in_vertex_index: u32
) -&gt; [[builtin(position)]] vec4&lt;f32&gt; {
    // 顶点着色器代码...
}
</code></pre></div><p>不过我们后面会为 <code>VertexOutput</code> 添加更多的字段，所以不妨从现在就开始使用它。</p></div> <p>接下来是片元着色器了。继续在 <code>shader.wgsl</code> 中加入以下内容即可：</p> <div class="language-wgsl extra-class"><pre class="language-text"><code>// 片元着色器

[[stage(fragment)]]
fn fs_main(in: VertexOutput) -&gt; [[location(0)]] vec4&lt;f32&gt; {
    return vec4&lt;f32&gt;(0.3, 0.2, 0.1, 1.0);
}
</code></pre></div><p>这会将当前片元的颜色设置为棕色。</p> <div class="note"><p>注意顶点着色器的入口点被命名为 <code>vs_main</code>，而片元着色器的入口点被称为 <code>fs_main</code>。在 wgpu 的早期版本中，这两个函数可以采用相同的名称，但较新版本的 <a href="https://www.w3.org/TR/WGSL/#declaration-and-scope" target="_blank" rel="noopener noreferrer">WGSL 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>要求它们使用不同的名称。因此，上面提到的命名方案（该方案也在 wgpu 自身示例中应用）将在整个教程中应用。</p></div> <p><code>[[location(0)]</code> 标记会告知 wgpu 将该函数返回的 <code>vec4</code> 值存储在其第一个颜色目标中。后面我们会介绍其详细含义。</p> <h2 id="如何使用着色器"><a href="#如何使用着色器" class="header-anchor">#</a> 如何使用着色器？</h2> <p>这里终于用到了本节标题中提到的 pipeline 概念。我们首先需要修改 <code>State</code> 来加入以下字段：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// main.rs</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span>
    surface<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Surface</span><span class="token punctuation">,</span>
    device<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">,</span>
    queue<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Queue</span><span class="token punctuation">,</span>
    config<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">SurfaceConfiguration</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> <span class="token namespace">winit<span class="token punctuation">::</span>dpi<span class="token punctuation">::</span></span><span class="token class-name">PhysicalSize</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token comment">// NEW!</span>
    render_pipeline<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipeline</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在我们看一下 <code>new()</code> 方法，可以在此开始构建 pipeline。为此我们需要先载入前面写好的着色器，它们是 <code>render_pipeline</code> 所需要的：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> shader <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderSource</span><span class="token punctuation">::</span><span class="token class-name">Wgsl</span><span class="token punctuation">(</span><span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.wgsl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="note"><p>你也可以把 <code>include_wgsl!</code> 宏作为创建 <code>ShaderModuleDescriptor</code> 的一条小捷径：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> shader <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">include_wgsl!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.wgsl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <p>另外我们还需要创建一个 <code>PipelineLayout</code>。在介绍完 <code>Buffer</code> 之后，我们会对这个概念有更多的了解：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> render_pipeline_layout <span class="token operator">=</span>
    device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline Layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        push_constant_ranges<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后我们就获得了创建 <code>render_pipeline</code> 所需的全部内容：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> render_pipeline <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_render_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipelineDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    layout<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pipeline_layout<span class="token punctuation">)</span><span class="token punctuation">,</span>
    vertex<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexState</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>shader<span class="token punctuation">,</span>
        entry_point<span class="token punctuation">:</span> <span class="token string">&quot;vs_main&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 1.</span>
        buffers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 2.</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    fragment<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FragmentState</span> <span class="token punctuation">{</span> <span class="token comment">// 3.</span>
        module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>shader<span class="token punctuation">,</span>
        entry_point<span class="token punctuation">:</span> <span class="token string">&quot;fs_main&quot;</span><span class="token punctuation">,</span>
        targets<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorTargetState</span> <span class="token punctuation">{</span> <span class="token comment">// 4.</span>
            format<span class="token punctuation">:</span> config<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
            blend<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendState</span><span class="token punctuation">::</span><span class="token constant">REPLACE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            write_mask<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorWrites</span><span class="token punctuation">::</span><span class="token constant">ALL</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// continued ...</span>
</code></pre></div><p>这里有几点值得注意：</p> <ol><li>我们可以在此指定应将着色器中的哪个函数作为 <code>entry_point</code>。它们分别对应着色器中用 <code>[[stage(vertex)]]</code> 和 <code>[[stage(fragment)]</code> 标记的函数。</li> <li><code>buffers</code> 字段用于告知 wgpu 我们要传递给顶点着色器的顶点类型。由于我们会直接在顶点着色器中指定顶点，因此在此留空。下一篇教程中会涉及更多这部分内容。</li> <li><code>fragment</code> 就技术上而言是可选的，所以必须将其包装在 <code>Some()</code> 中。如果想将颜色数据存储到 <code>surface</code>，那么就需要使用它。</li> <li><code>targets</code> 字段告诉 wgpu 应该设置哪些颜色输出。目前我们只需为 <code>surface</code> 设置单个输出。这里使用 <code>surface</code> 的格式配置以便复制，并且指定混合模式（blending）为仅用新数据替换旧像素数据。此外我们还要求 wgpu 写入所有像素通道的颜色，即红、蓝、绿和 alpha。我们将在讨论纹理时更多地介绍 <code>color_state</code>。</li></ol> <div class="language-rust extra-class"><pre class="language-rust"><code>    primitive<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveState</span> <span class="token punctuation">{</span>
        topology<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveTopology</span><span class="token punctuation">::</span><span class="token class-name">TriangleList</span><span class="token punctuation">,</span> <span class="token comment">// 1.</span>
        strip_index_format<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        front_face<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FrontFace</span><span class="token punctuation">::</span><span class="token class-name">Ccw</span><span class="token punctuation">,</span> <span class="token comment">// 2.</span>
        cull_mode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Face</span><span class="token punctuation">::</span><span class="token class-name">Back</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 如果将该字段设置为除了 Fill 之外的任何值，都需要 Features::NON_FILL_POLYGON_MODE</span>
        polygon_mode<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PolygonMode</span><span class="token punctuation">::</span><span class="token class-name">Fill</span><span class="token punctuation">,</span>
        <span class="token comment">// 需要 Features::DEPTH_CLIP_ENABLE</span>
        unclipped_depth<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// 需要 Features::CONSERVATIVE_RASTERIZATION</span>
        conservative<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// continued ...</span>
</code></pre></div><p><code>primitive</code> 字段描述了应如何将我们所提供的顶点数据转为三角形：</p> <ol><li><code>PrimitiveTopology::TriangleList</code> 表示每三个顶点将对应一个三角形。</li> <li><code>front_face</code> 和 <code>cull_mode</code> 字段告诉 wgpu 应如何确定某个三角形是否朝前。<code>FrontFace::Ccw</code> 表示如果顶点按逆时针方向排列，则判定三角形是朝前的。不满足朝前条件的三角形会被剔除（即不被渲染），这是用 <code>CullMode::Back</code> 所确定的。我们将在讨论 <code>Buffer</code> 时进一步介绍剔除问题。</li></ol> <div class="language-rust extra-class"><pre class="language-rust"><code>    depth_stencil<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span> <span class="token comment">// 1.</span>
    multisample<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">MultisampleState</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 2.</span>
        mask<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 3.</span>
        alpha_to_coverage_enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 4.</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    multiview<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span> <span class="token comment">// 5.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这个方法中的剩余部分相当简单：</p> <ol><li>我们目前没有使用深度 / 模板缓冲区，所以这里把 <code>depth_stencil</code> 设为 <code>None</code>。<em>这一点在后面会有所变化</em>。</li> <li><code>count</code> 决定了 pipeline 将使用多少次采样。多采样是个复杂的话题，不会在这里展开讨论。</li> <li><code>mask</code> 指定了哪些采样应被设为活跃。目前我们将使用所有的采样。</li> <li><code>alpha_to_coverage_enabled</code> 与抗锯齿有关。这里尚不涉及抗锯齿，所以现在将其设置为 false。</li> <li><code>multiview</code> 用于表示渲染 attachment 中可以带有多少个 <a href="https://www.w3.org/TR/webgpu/#array-layer" target="_blank" rel="noopener noreferrer">array layer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。我们不会对纹理阵列做渲染，所以可以将其设置为 <code>None</code>。</li></ol> <p>现在我们只要把 <code>render_pipeline</code> 添加到 <code>State</code>中就可以了!</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// new()</span>
<span class="token keyword">Self</span> <span class="token punctuation">{</span>
    surface<span class="token punctuation">,</span>
    device<span class="token punctuation">,</span>
    queue<span class="token punctuation">,</span>
    config<span class="token punctuation">,</span>
    size<span class="token punctuation">,</span>
    <span class="token comment">// NEW!</span>
    render_pipeline<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="使用-pipeline-2"><a href="#使用-pipeline-2" class="header-anchor">#</a> 使用 Pipeline</h2> <p>如果你现在运行起程序，会发现它虽然有更长的启动时间，但仍然会显示在上一节中得到的蓝屏效果。这是因为虽然我们创建了 <code>render_pipeline</code>，但还需要修改 <code>render()</code> 中的代码才能实际使用它：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// render()</span>

<span class="token comment">// ...</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 1.</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> render_pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_render_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        color_attachments<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token comment">// 这就是片元着色器中 [[location(0)]] 对应的目标</span>
            <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassColorAttachment</span> <span class="token punctuation">{</span>
                view<span class="token punctuation">:</span> <span class="token operator">&amp;</span>view<span class="token punctuation">,</span>
                resolve_target<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                ops<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Operations</span> <span class="token punctuation">{</span>
                    load<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">LoadOp</span><span class="token punctuation">::</span><span class="token class-name">Clear</span><span class="token punctuation">(</span>
                        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Color</span> <span class="token punctuation">{</span>
                            r<span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                            g<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
                            b<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
                            a<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    store<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        depth_stencil_attachment<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// NEW!</span>
    render_pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>render_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2.</span>
    render_pass<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre></div><p>这部分没有多少变化，但这里还是简单介绍下我们的改动：</p> <ol><li>我们把 <code>_render_pass</code> 重命名为了 <code>render_pass</code>，并将其设置为 mutable 变量。</li> <li>我们在 <code>render_pass</code> 上设置了刚创建出的 pipeline。</li> <li>我们告诉 wgpu 用 3 个顶点和 1 个实例来做绘制，这就是 <code>[[builtin(vertex_index)]]</code> 的数据来源（即未对顶点着色器传入三角形各点坐标，仅根据 0 1 2 的数组下标索引各自计算出了三角形各点位置，译者注）。</li></ol> <p>有了这些之后，你应该就能看到一个可爱的棕色三角形了：</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyIAAAJzCAYAAADz6Ke4AAAABHNCSVQICAgIfAhkiAAAABl0RVh0U29mdHdhcmUAZ25vbWUtc2NyZWVuc2hvdO8Dvz4AAByFSURBVHic7d1rkJ31fdjx3zl7EyAkIaEVSDJIsgdjiRiZCNIa5DQGh2majlt3WrtTe/rCY0/z2nnXvmtnept22pmOp3Y742ntJG2aJm16iwmMCWNS18gEEwwYBEK2bruLtLqiy+45T18ICV1W2ts5v/NcPp9XuuwePXvO8/z//+//Obtqbdy4sSiKIoaGhuLhhx+P7ds3x/r162N0dDQAAACWY2ZmJqanp+Oll16KPXv2RKfTiVarFcNFUcSqVavi85//fOzevTt2794dY2Njgz5eAACgJk6dOhV79uyJ559/Pr7zne/EyZMnY3hoaCi+8IUvxNe+9rWIiJieno5utzvgQwUAAOpiaGgoPv7xj8euXbsiIuIb3/hGDO/atSsef/zxaLVacfLkyQEfIgAAUDedTic6nU6cP38+HnnkkdizZ08Mb9++PR588ME4ffp0FEUx6GMEAABq7L777oudO3fG8Pj4eKxatcrdEAAAoO+Gh4dj7dq10R4dHY1OpzPo4wEAABpiZGQkhiMuvmfL27IAAIAsQgQAAEjXjghvzQKoou6h+P5/+Nfxr/7907HvQh8/p9/HdJ1OvPPU1+Of/7N/Ef/l5ffCNhnA4ExMTMSPf/zjq/57j6Io4uWXX47Dhw8v67HdEQGoqiKimJmN2QvdiKIbRdFa0ucU5w7GK392JFbueCi2rlrAY/T6mOYwOtaOiFaMjrXNTwAL8N3vfjciIp588smePeb09PTlCGm327Fjx44oiiJeeeWVOHz4cBw5ciTGxsbijjvuWNLjD0dEdLtdAz1A1bS3xK///X8af6OYjZOT78Z73QWM49d9TjdOv/GDeOZPj8Un7t0ZW25v5x/TdYpotd4PmKKIKAp3RQAWqJdr+vHx8di2bVvs3bs3Dh48GK1WKzqdzuU7IR/+8IdjfHw8LlxY2i3wy3dEABi0M/Hy7/27eGr/bfGLX/hy/MqmVrz7f78d//H5yShW7oy/+ZUn4p72dLzw29+KP5lYH4998ZNx/N/8t3hlZlv82m/89dg+/Hb80b/9g3hj8xPx2c0H4rkX9sa750di7bZfis/86i/GxrGImH01fucf/MH7n/PZuPvtP47/9dw7Mdvtxg9/61/GD1u3xC987u/Fk1uH8o4pIi5M/Fn88VM/iL1HZ+O2zQ/GznVj0Yozl5+Z4uzBePHZ5+LFtybiTGcs1my+P37plx+Lj915YXHH93e/GH9h3TLv+gA0xMzMTDzyyCMxPDwcr7/+ehw4cODy391///3x0EMPxdGjR5f8+N6aBVAaK+O+7ZvimXcOxOTEiehuHI3JyemIkZEYOjsVUye68aEVE3HkaBHttffHx8ZXxIvtiGiNxViriCLGYqwdMfP29+L3998eG+/9UKz9+b6Y+umfxFN3bIovPboh2u9/zKXPmS2GY8VoRHFuLO7e/onYsnpFbL6zdcWckHBMswfi+f/5vXh9uoiROzbG6rOvxvMvvRdFtCOiiKJ7NH70h78fzx64ECvW3RtbbjkeP3vnR/G/330v2l/8K4s7vvURRcd8B9TD008/fd0a/qmnnrr868985jPLevyiKGJqaip27twZExMTMT09HRERa9eujZ07d8bU1NSyHl+IAJRGJ27ZtDXWtn8WRw4eibMPrIhDh7px10MPx+ieF+Pw5LmYWXEoDs5E3LrtnlgzO/PBpxbF5XG86I7GA3/nN+NLvzAa7734rfhH/+nVOH70WJwvxmPFlWN90Y6ND//leOjNl+OdU7fFR3b/evzava04d+JYnLpQpB3T6OG9sfdEN1rrHo0vf+1z8ZHRk/GDb/7j+L03uhFRROfwq/HnB89H+86/FF/9zb8a9wydi1d/55/Et158M156/Xh89COLOL5OEToEyPD000/f9O+feOKJvh9DL9b3RVHEc889dzlCIiKOHTsWzz77bOzYseODt9IugbdmAZRI9457YuutES8cOhITUyvi0LlbYut922P0zRfi5YmpeHfsYLwXI7F9y3h04+DcD9LeFFvWTsehw91oja2J21oRJy9+q8U1ijh/cjrOFxd/PXv6aExNXT+h9PuYZs6ejjPdVoxu2Rqrjx2Mg92huHPL+mi/MRERETOnjseJbitGNm+MFZMH41DRjtX3bIyhH70RR49Px+xijs+mG1AjX/nKVy7/+pvf/GZERHz1q1+9/Gdvv/32sh6/KIr4yU9+EkeOHImIiB07dkS3243XXnvtqj9baoy4IwJQIsXsnbFly0i88NpUHNk/Gsdam+Ivrl0TY5uH4k8nD8X+kaNRtO+NrXcVVy+qr7j7EO2RaHc7UbQiurOXPqZ19cdc/pyr/vU5YqX/xxTtixNYq3shznaKaMdMXOhcmtSKiKH3v4G+eyHOdYsYik6cm7n4YyRb7eGlHx9AH10ZBHN56623lv1vzPUYvXjcS06cOBGTk5MREfHRj340HnjggYi42A5vvPFGTE5OxubNm2P16tVLenw/NQugTIpWbNi6Odo/mYh39o9FrHswxociRjbeFa19+2LfcDdaG7bFpuFuFLNXfNo1UVF0iijaccVPmyqu/5j3fxpVq92KKDoxM9ONopjjp2b1+ZhGVt8RK1tFnPz5vjh0YWNsGj4TB382Fd2LDxKj6zfEuvZrMXVgfxy+sDk2jZyLA+8cjk6rHeMb1karGws/vg9+DD5AX+3du3cg/26vf2rWpz/96di/f/9V3xPy0EMPRbfbjS1btsTo6GicO3duSY9/+Y7Ict7fBUCvdGN049ZY39oXRw6fjbGdd8XtRTdi/O649cwLcaSIWL1jc6wsImbnf7AFGIs1a2+NVnEqfvx//nNMrGrH2k98Ln7lwyNpx9Qa3xEfX/f/4rmje+IPf+tArB87E1NHZyPi/Xlp3Sdi930/jP/60w/+fmLydMTtO+OTH7stojOb/JwBlM+lOzC9DKBz587FypUrY9euXTExMXH5zycnJ+Phhx+OM2fOxOnTp5f8+JdDZGhoaL6PBSBBZ+WHYtuqiCPHW7Fx07rodouINXfH3e0iftq5Jbbdc0fMdjvX392Y4/fzf0wrNj361+KTh/97vPDzd2Mi7oqtq67/TwT7eUzd2XXxy1/6XJz+3T+KP584ERc2Px5ffnIyvv3tH0UUEd3zQ/Gxv/0b8bee+h/xvZf2xeEzo7Huvt3xq599Iu7tHIvTxSKOb5mvDUBZvfnmm3153FOnTsWpU6eu+/NL3yOyHK2vf/3rxac+9akYGRmZ/6MB6L/WrTG+dXOsGS7i7OQ78fPjMxHDq2Pz1g1xa6sTpw7ti8OnuxGt22LDtk2xun06jrx1KE4W1/y+G9G6ZTy2fGhNDL83GfsOHI/Zaz+nG9EauT3G714ft48NRXQuxPEjP4t33yvyjiki2ivWxIYN62LlaMTMmemYPD0ad991e5ybeDsOnuhEDK2INXfeGWtW3hIj7W7MnD0Vx6bejZPnu4s7PgBK4ZlnnrkYIo8++misWLFi0McDAAA0wDPPPHPxrVljY2O+WR0AAEgzHNHb764HAACYzxw/pxEAAKC/3BEBAADSDUdE/MPf/t6gjwMAAGiI3Rtb3poFAADkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABAOiECAACkEyIAAEA6IQIAAKQTIgAAQDohAgAApBMiAABA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9Ri7of+ECAAAkE6IQB/ZUQOoLmM49JcQgT4xgQFUn7Ec+keIAAAA6YQI9IEdNID6MKZDfwgR6DETFkD9GNuh94QIAACQTohAD9kxA6gvYzz0lhCBHjFBAdSfsR56R4gAAADphAj0gB0ygOYw5kNvCBFYJhMSQPMY+2H5hAgAAJBOiMAy2BEDaC5zACyPEIElMgEBYC6ApRMiAABAOiECS2AHDIBLzAmwNEIEFsmEA8C1zA2weEIEAABIJ0RgEex4AXAj5ghYHCECC2SCAWA+5gpYOCECAACkEyKwAHa4AFgocwYsjBCBeZhQAFgscwfMb3jQBwBl9/14bNCHAABQO+6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmECAAAkE6IAAAA6YQIAACQTogAAADphAgAAJBOiAAAAOmGIyJ2b2wN+jgAAIAG+f/bSmo4C4fjXQAAAABJRU5ErkJggg==" alt="Said lovely brown triangle"></p> <h2 id="小测验"><a href="#小测验" class="header-anchor">#</a> 小测验</h2> <p>创建第二个 pipeline，在其中用三角形的位置数据创建出一种颜色，并将其发送给片元着色器。当按下空格键时，让程序在这些 pipeline 之间做切换。<em>提示：这需要修改 <code>VertexOutput</code></em>。</p> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/beginner/tutorial3-pipeline/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/24/2022, 2:22:00 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu-cn/beginner/tutorial2-surface/" class="prev">
          使用 Surface
        </a></span> <span class="next"><a href="/learn-wgpu-cn/beginner/tutorial4-buffer/">
          顶点缓冲区与索引缓冲区
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu-cn/assets/js/app.4ff5359b.js" defer></script><script src="/learn-wgpu-cn/assets/js/4.7de995c5.js" defer></script><script src="/learn-wgpu-cn/assets/js/15.866ab171.js" defer></script><script src="/learn-wgpu-cn/assets/js/25.997fcfd2.js" defer></script>
  </body>
</html>
