<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>依赖与窗口 | 学习 Wgpu</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    <meta property="article:modified_time" content="2022-04-30T14:50:47.000Z"><meta property="og:site_name" content="学习 Wgpu"><meta property="og:title" content="依赖与窗口"><meta property="og:type" content="website"><meta property="og:url" content="/beginner/tutorial1-window/"><meta name="twitter:title" content="依赖与窗口"><meta name="twitter:url" content="/beginner/tutorial1-window/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label1" content="Written by"><meta name="twitter:data2" content="Benjamin Hansen"><meta name="twitter:creator" content="https://twitter.com/sotrh760">
    <link rel="preload" href="/learn-wgpu-cn/assets/css/0.styles.2f5dce02.css" as="style"><link rel="preload" href="/learn-wgpu-cn/assets/js/app.4a62b3f5.js" as="script"><link rel="preload" href="/learn-wgpu-cn/assets/js/4.9ddd2a75.js" as="script"><link rel="preload" href="/learn-wgpu-cn/assets/js/28.0d853b3b.js" as="script"><link rel="preload" href="/learn-wgpu-cn/assets/js/25.5a7a1f31.js" as="script"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/1.e1054b07.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/10.1b6d1cf6.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/11.1001c632.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/12.7e1fa0ed.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/13.c591e8de.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/14.1821141e.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/15.795372a4.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/16.14679006.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/17.36012420.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/18.3941048f.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/19.f3f8b412.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/2.ce803252.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/20.140d2648.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/21.a801933f.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/22.d1c5beb9.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/23.ffb83767.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/24.6a0d1e12.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/26.a5048f3d.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/27.14e287f6.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/29.c45319b3.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/30.f4b97050.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/31.ab88ef7b.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/32.21765d0f.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/33.4daba1cc.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/34.9d2cb00a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/35.45887274.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/36.c0c5124a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/5.9e56ad9a.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/6.8eb3b610.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/7.e1535c20.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/8.a6ef1f77.js"><link rel="prefetch" href="/learn-wgpu-cn/assets/js/9.62cbd082.js">
    <link rel="stylesheet" href="/learn-wgpu-cn/assets/css/0.styles.2f5dce02.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu-cn/" class="home-link router-link-active"><!----> <span class="site-name">学习 Wgpu</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu-cn/" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-cn/beginner/tutorial1-window/" class="active sidebar-link">依赖与窗口</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial1-window/#是的，这段有些枯燥" class="sidebar-link">是的，这段有些枯燥</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial1-window/#我们要使用哪些-crate" class="sidebar-link">我们要使用哪些 crate?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial1-window/#使用-rust-的新版特性解析器" class="sidebar-link">使用 Rust 的新版特性解析器</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial1-window/#关于-env-logger" class="sidebar-link">关于 env_logger</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-cn/beginner/tutorial1-window/#代码示例" class="sidebar-link">代码示例</a></li></ul></li><li><a href="/learn-wgpu-cn/beginner/tutorial2-surface/" class="sidebar-link">使用 Surface</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial3-pipeline/" class="sidebar-link">使用 Pipeline</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial4-buffer/" class="sidebar-link">顶点缓冲区与索引缓冲区</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial5-textures/" class="sidebar-link">纹理与 BindGroup</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial6-uniforms/" class="sidebar-link">Uniform 缓冲区与 3D 相机</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial7-instancing/" class="sidebar-link">实例化绘制</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial8-depth/" class="sidebar-link">深度缓冲区</a></li><li><a href="/learn-wgpu-cn/beginner/tutorial9-models/" class="sidebar-link">加载模型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-cn/intermediate/tutorial10-lighting/" class="sidebar-link">🚧 处理光照效果</a></li><li><a href="/learn-wgpu-cn/intermediate/tutorial11-normals/" class="sidebar-link">🚧 法线贴图</a></li><li><a href="/learn-wgpu-cn/intermediate/tutorial12-camera/" class="sidebar-link">🚧 更好的相机</a></li><li><a href="/learn-wgpu-cn/intermediate/tutorial13-threading/" class="sidebar-link">🚧 基于 Wgpu 和 Rayon 的多线程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>案例展示</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>更新动态</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="依赖与窗口"><a href="#依赖与窗口" class="header-anchor">#</a> 依赖与窗口</h1> <h2 id="是的，这段有些枯燥"><a href="#是的，这段有些枯燥" class="header-anchor">#</a> 是的，这段有些枯燥</h2> <p>有些读者应当已经非常熟悉如何在 Rust 中打开 GUI 窗口，也可能有自己最喜欢的窗口管理库。但本文档是为所有人设计的，所以这一部分也需要涉及。所幸你只要知道这是在做什么，就可以跳过本部分。只有一点值得了解，即无论你使用什么样的窗口解决方案，都需要支持 <a href="https://github.com/rust-windowing/raw-window-handle" target="_blank" rel="noopener noreferrer">raw-window-handle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这个 crate。</p> <h2 id="我们要使用哪些-crate"><a href="#我们要使用哪些-crate" class="header-anchor">#</a> 我们要使用哪些 crate?</h2> <p>我们将尽量保持入门部分的简单性。在后续深入时我们会逐渐添加依赖，但这里先列出了相关的 <code>Cargo.toml</code> 内容如下：</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.23&quot;</span>
<span class="token key property">winit</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.26&quot;</span>
<span class="token key property">cgmath</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.18&quot;</span>
<span class="token key property">env_logger</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.9&quot;</span>
<span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.4&quot;</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.12&quot;</span>
<span class="token key property">pollster</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2&quot;</span>
</code></pre></div><h2 id="使用-rust-的新版特性解析器"><a href="#使用-rust-的新版特性解析器" class="header-anchor">#</a> 使用 Rust 的新版特性解析器</h2> <p>自 0.10 版本起，wgpu 需要使用 cargo 的<a href="https://doc.rust-lang.org/cargo/reference/resolver.html#feature-resolver-version-2" target="_blank" rel="noopener noreferrer">新版特性解析器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这在 Rust 的 2021 edition（即任何基于 Rust 1.56.0 或更新版本的新项目）中是默认启用的。但如果你仍在使用 2018 edition 的 Rust，那么你需要在 <code>Cargo.toml</code> 的 <code>[package]</code> 段落添加 <code>resolver = &quot;2&quot;</code>，或在 workspace 的根级 <code>Cargo.toml</code> 的 <code>[workspace]</code> 段落加入这段配置。</p> <h2 id="关于-env-logger"><a href="#关于-env-logger" class="header-anchor">#</a> 关于 env_logger</h2> <p>通过 <code>env_logger::init()</code> 来启用日志是非常重要的。当 wgpu 遇到各类错误时，它都会用一条通用性的消息抛出 panic，并通过日志 crate 来记录真正的错误信息。这意味着如果不添加 <code>env_logger::init()</code>，wgpu 将静默地退出，从而使你非常困惑！</p> <h2 id="代码示例"><a href="#代码示例" class="header-anchor">#</a> 代码示例</h2> <p>这一部分没有太多特别之处，所以这里直接完整地贴出代码。只需将其粘贴到你的 <code>main.rs</code> 或类似位置即可：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">winit<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">event<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">,</span>
    <span class="token namespace">event_loop<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">ControlFlow</span><span class="token punctuation">,</span> <span class="token class-name">EventLoop</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">window<span class="token punctuation">::</span></span><span class="token class-name">WindowBuilder</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> event_loop <span class="token operator">=</span> <span class="token class-name">EventLoop</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> window <span class="token operator">=</span> <span class="token class-name">WindowBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event_loop<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    event_loop<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>event<span class="token punctuation">,</span> _<span class="token punctuation">,</span> control_flow<span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">match</span> event <span class="token punctuation">{</span>
        <span class="token class-name">Event</span><span class="token punctuation">::</span><span class="token class-name">WindowEvent</span> <span class="token punctuation">{</span>
            <span class="token keyword">ref</span> event<span class="token punctuation">,</span>
            window_id<span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token keyword">if</span> window_id <span class="token operator">==</span> window<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">match</span> event <span class="token punctuation">{</span>
            <span class="token class-name">WindowEvent</span><span class="token punctuation">::</span><span class="token class-name">CloseRequested</span>
            <span class="token operator">|</span> <span class="token class-name">WindowEvent</span><span class="token punctuation">::</span><span class="token class-name">KeyboardInput</span> <span class="token punctuation">{</span>
                input<span class="token punctuation">:</span>
                    <span class="token class-name">KeyboardInput</span> <span class="token punctuation">{</span>
                        state<span class="token punctuation">:</span> <span class="token class-name">ElementState</span><span class="token punctuation">::</span><span class="token class-name">Pressed</span><span class="token punctuation">,</span>
                        virtual_keycode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">VirtualKeyCode</span><span class="token punctuation">::</span><span class="token class-name">Escape</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">..</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">..</span>
            <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token operator">*</span>control_flow <span class="token operator">=</span> <span class="token class-name">ControlFlow</span><span class="token punctuation">::</span><span class="token class-name">Exit</span><span class="token punctuation">,</span>
            _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>上述代码所做的全部工作不过是创建了一个窗口，并在用户关闭或按下 escape 键前使其保持打开。在下一篇教程中，我们将真正开始使用 wgpu!</p> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/beginner/tutorial1-window/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/30/2022, 2:50:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu-cn/" class="prev router-link-active">
          介绍
        </a></span> <span class="next"><a href="/learn-wgpu-cn/beginner/tutorial2-surface/">
          使用 Surface
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu-cn/assets/js/app.4a62b3f5.js" defer></script><script src="/learn-wgpu-cn/assets/js/4.9ddd2a75.js" defer></script><script src="/learn-wgpu-cn/assets/js/28.0d853b3b.js" defer></script><script src="/learn-wgpu-cn/assets/js/25.5a7a1f31.js" defer></script>
  </body>
</html>
